---
title: "Geoducation"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,tidy.opts=list(width.cutoff=60),tidy=TRUE)
(WD <- getwd())
if (!is.null(WD)) setwd(WD)
```
\begin{center}
\textit{Antoine Drouhin, Aurélien Garret, Cécile Hu, Lucas Morel}
\end{center}
# TODO, Note/CR de Réunion avec la prof :
* décrire la base de données : taille, variable quantitatif ou qualitatif (à faire pour la présentation orale)
* Ségrégation scolaire
* Idée :
  * Essayer de faire une classification sur les différents taux de réussite et les filières (pas étonné qu'en ts gros tx de réussite, qu'en L non etc,...) Essayer de voir pourquoi meilleur on est meilleur on sera et vice versa.
  * Choisir un indicateur de réussite, créer un indicateur en additionnant les taux de réussite par lycée, puis régression pouvoir si dépend de la filière et de la géographie.
  * Secteur privé/public
  * Rural/urbain
  * Puis régression synthétique
  * Cherche taille des communes pour joindre


## Introduction

### Base de données

Notre de base de données a été trouvée sur le site Data.gouv. 
Nous avons croisé deux jeux de données distincts. Le premier concerne des données sur la performance des lycées en France (taux de réussite etc). Le second présente des données géographiques pour l’ensemble des établissements scolaires français (Coordonnées GPS, etc.).

<https://www.data.gouv.fr/fr/>

Nous avons choisi cette base car elle présente une approche intéressante sur la compréhension d’un sujet qui nous concerne tous, l’éducation.
L’approche géographique des questions de réussite scolaire nous a semblé être un champ suffisamment complet pour permettre l’utilisation des méthodes d’analyse vue en cours.

La base de données comporte de nombreuses données qui sont réparties sur toutes la France. Nous avons des répartitions de données par établissements, villes, départements et académies. Par ailleurs l'ensemble des bacs généraux et technologiques ainsi que certains bacs professionnels sont représentés. 
```{r, include=FALSE}

read.csv2("geoducation-data2.csv", sep=";", header=TRUE, na.strings = "", encoding = "UTF-8")->bdd
bddEff = bdd[, c('Académie','Effectif.Présents.Total.séries')]
# Petit clean des datas (Antoine)
bddEff[is.na(bddEff)] <- 0
tableEff <- data.frame()
indiceCourant = 1
aca <- bddEff[1,"Académie"]

for(i in 1:nrow(bddEff)){
  if(aca != bddEff[i,"Académie"]){
    indiceCourant = indiceCourant + 1
    aca <- bddEff[i,"Académie"]
  } 
  if (length(rownames(tableEff)) != 0 && !is.na(tableEff[indiceCourant,"Académie"]) && bddEff[i,"Académie"] == tableEff[indiceCourant,"Académie"] ){
    tableEff[indiceCourant,"Effectif"] <- tableEff[aca,"Effectif"] + bddEff[i,"Effectif.Présents.Total.séries"]
  } else {
    tableEff <- rbind(tableEff, data.frame("Académie" = aca,"Effectif" = bddEff[i,"Effectif.Présents.Total.séries"]))
  }
}
seuil <- mean(tableEff[,2])
autre = 0
tableRes <- data.frame("Académie" = character(), "Effectifs" = double(), stringsAsFactors = FALSE)
for(i in 1:length(tableEff[,'Académie'])){
  if(tableEff[i,2]< seuil){
    autre = autre + tableEff[i,'Effectif']
  }
  else {
    tableRes[i,'Académie'] <- as.character(tableEff[i,"Académie"])
    tableRes[i,2] <- tableEff[i,2]
  }
}
tableRes[length(tableRes[,"Académie"])+1,"Académie"]="Autre"
tableRes[length(tableRes[,"Académie"]),"Effectifs"]=autre
tableRes<-tableRes[-which(is.na(tableRes[])),]
slices <- tableRes[,2]
lbls <- tableRes[,1]
```
```{r}
print(pie(slices, labels = lbls, main="Répartition des effectifs par académie"))
```
L'intérêt et le questionnement général porte sur la réussite scolaire de la France en fonction de la position géographique des établissements scolaires. Y a-t-il une corrélation entre la situation géographique des établissements et la réussite scolaire des étudiants ?

Plusieurs problématiques en découlent comme :

Y a-t-il des différences de réussites entre le top 10 des grandes villes en France et les villes de province ?
Paris bénéficie-t-elle d’une réussite supérieure au reste de la France ?
Quelles régions de France semblent réussir mieux que les autres ?
#### Initialisation de la base de données

```{r}
read.csv2("geoducation-data2.csv", sep=";", header=TRUE, na.strings = "", encoding = "UTF-8")->bdd
#exists('bdd')
```

## Khi-Deux

```{r}

bddKhiDeux = bdd[, c('Académie','Effectif.Présents.série.L','Effectif.Présents.série.ES','Effectif.Présents.série.S')]
# Petit clean des datas (Antoine)
bddKhiDeux[is.na(bddKhiDeux)] <- 0

# Cette portion de code supporse que bdd est ordonné par nom d'académie. (Antoine)

tableKhiDeux <- data.frame()
indiceCourant = 1
aca <- bddKhiDeux[1,"Académie"]

for(i in 1:nrow(bddKhiDeux)){
  if(aca != bddKhiDeux[i,"Académie"]){
    indiceCourant = indiceCourant + 1
    aca <- bddKhiDeux[i,"Académie"]
  } 
  if (length(rownames(tableKhiDeux)) != 0 && !is.na(tableKhiDeux[indiceCourant,"Académie"]) && bddKhiDeux[i,"Académie"] == tableKhiDeux[indiceCourant,"Académie"] ){
    tableKhiDeux[indiceCourant,"ES"] <- tableKhiDeux[aca,"ES"] + bddKhiDeux[i,"Effectif.Présents.série.ES"]
    tableKhiDeux[indiceCourant,"L"] <- tableKhiDeux[aca,"L"] + bddKhiDeux[i,"Effectif.Présents.série.L"]
    tableKhiDeux[indiceCourant,"S"] <- tableKhiDeux[aca,"S"] + bddKhiDeux[i,"Effectif.Présents.série.S"]
  } else {
    tableKhiDeux <- rbind(tableKhiDeux, data.frame(Académie = aca,ES = bddKhiDeux[i,"Effectif.Présents.série.ES"], S = bddKhiDeux[i,"Effectif.Présents.série.S"], L = bddKhiDeux[i,"Effectif.Présents.série.L"]))
  }
}

print(tableKhiDeux)
```

On dispose ici de la table de départ pour calculer le Khi Deux. Cette table nous donne l'agrégation des effectifs par filière et par académie.

```{r}
# Calcul de la table des Abstrait
abstraitKhiDeux <- tableKhiDeux

for(i in 1:nrow(abstraitKhiDeux)){
  abstraitKhiDeux$ES[i] = sum(tableKhiDeux$ES)*sum(tableKhiDeux[i,'ES'],tableKhiDeux[i,'S'],tableKhiDeux[i,'L'])/sum(tableKhiDeux$ES,tableKhiDeux$S,tableKhiDeux$L)
  abstraitKhiDeux$S[i] = sum(tableKhiDeux$S)*sum(tableKhiDeux[i,'ES'],tableKhiDeux[i,'S'],tableKhiDeux[i,'L'])/sum(tableKhiDeux$ES,tableKhiDeux$S,tableKhiDeux$L)
  abstraitKhiDeux$L[i] = sum(tableKhiDeux$L)*sum(tableKhiDeux[i,'ES'],tableKhiDeux[i,'S'],tableKhiDeux[i,'L'])/sum(tableKhiDeux$ES,tableKhiDeux$S,tableKhiDeux$L)
}

#Calcul de la table des écarts
ecartsKhiDeux <- tableKhiDeux

for(i in 1:nrow(abstraitKhiDeux)){
  ecartsKhiDeux$ES[i] = tableKhiDeux$ES[i] - abstraitKhiDeux$ES[i]
  ecartsKhiDeux$S[i] = tableKhiDeux$S[i] - abstraitKhiDeux$S[i]
  ecartsKhiDeux$L[i] = tableKhiDeux$L[i] - abstraitKhiDeux$L[i]
}

#Calcul de la table des contributions
contribKhiDeux <- tableKhiDeux
i=1
for(i in 1:nrow(abstraitKhiDeux)){
  contribKhiDeux$ES[i] = ecartsKhiDeux$ES[i]*ecartsKhiDeux$ES[i] / abstraitKhiDeux$ES[i]
  contribKhiDeux$S[i] = ecartsKhiDeux$S[i]*ecartsKhiDeux$S[i] / abstraitKhiDeux$S[i]
  contribKhiDeux$L[i] = ecartsKhiDeux$L[i]*ecartsKhiDeux$L[i] / abstraitKhiDeux$L[i]
}

print(contribKhiDeux)

```

Ici nous avons appliqué les étapes successives permettant de calculer le Khi Deux. Soit la corrélation entre les deux variables qualitatives : Académies et Filière.

Sur la table des contributions (ci-dessus) on peut observer que certaines régions et séries ont une contribution fortes à rendre dépendante ces deux variables.

On peut constater que certaines académies correspondantes a des zones géographiques périphériques ont une influence forte sur le khi Deux. Mayotte, Corse et Guadeloupe notamment. Dans ces régions la répartition entre les filières est modifiées et on trouve notamment une plus grande proportion de personnes en filière Littéraire.

Certaines académies de métropoles ont également des comportements particulier, par exemple l'académie de Versailles a une proportion particulièrement forte de ES et faible de L. Les académies de Limoges, Montpellier et Strasbourg ont également des comportements qui s'écartent des standards.

On constate finalement que la proportion de filière L a une forte tendance à varier alors que les filières ES et S ont souvent une proportion stable l'une par rapport à l'autre (environs un peu moins de deux fois plus de S que de ES). Ainsi de nombreuses académies ont une proportion de L élevée (DOM-TOM etc..) ou faible (Lyon, Lille, Strasbourg etc..)

Finalement on calcule le score global de khi deux

```{r}
khideux <- chisq.test(tableKhiDeux[,c('S','ES','L')])
print(khideux)
```

Cet indicateur nous permet de dire que la situation géographique est certainement fortement dépendante de la répartition entre les filières.
En effet la probabilité que la situation géographique soit indépendante de la répartition dans les différentes filières est inférieure à 2.2e-16.

# Régression
## Est ce que le taux de réussite des élèves en terminale S s'explique par la localisation académique ?
### Problématique

Une interrogation récurrente vis à vis de la réussite scolaire est de se demander si la situation géographique d'un étudiant tend à lui offrir des chances supplémentaires d'obtenir son baccalauréat. 

Pour essayer de déterminer si l'académie a un rôle prédominant dans la réussite de l'élève nous allons chercher à connaitre l'impact de l'académie sur le taux de réussite au bac S, mais nous nous interrogerons aussi sur l'influence émise par les taux de réussite au baccalauréat L. Ainsi, un environnement, crée par la jointure entre une situation géographique donnée et un taux de réussite dans une autre filière donné, a-t-il un fort impact sur la réussite d'un élève passant son baccalauréat scientifique ?

Ainsi, nous allons créer une matrice comportant l'académie, l'effectif présent en série scientifique, le taux brut de réussite dans cette même série et le taux dans la série L. 
```{r}
bddReg = bdd[, c('Académie','Effectif.Présents.série.S', 'Taux.Brut.de.réussite.série.S', 'Taux.Brut.de.réussite.série.L')]
```
Nous procédons ensuite au nettoyage de notre matrice en retirant les valeurs nulles et en transformant les taux à une forme 0<x<1.De plus nous retirons les valeurs aberrantes, soit celles où il n'y a pas d'élève inscrit dans les filières étudiées.  
```{r}
#valeur non définies mise à 0
bddReg[is.na(bddReg)] <- 0
#transformation des taux
bddReg[3] <- bddReg[3]/100
bddReg[4] <- bddReg[4]/100

df=data.frame(bddReg[1],bddReg[2],bddReg[3], bddReg[4])
#suppression des données aberrantes
df<-df[(df$Effectif.Présents.série.S>0 & df$Taux.Brut.de.réussite.série.S>0 & df$Taux.Brut.de.réussite.série.L>0),]
```
Pour mener une étude par académie nous devons agréger l'ensemble des établissements scolaire appartenant à la même académie.
```{r}
#regroupement des effectifs par académie
regData = aggregate(df$Effectif.Présents.série.S, by=list(df$Académie), FUN=sum)
#moyenne de l'ensemble des taux de réussite des lycées par académie
regData = c(regData,aggregate(df$Taux.Brut.de.réussite.série.S, by=list(df$Académie), FUN=mean)[2])
regData = c(regData,aggregate(df$Taux.Brut.de.réussite.série.L, by=list(df$Académie), FUN=mean)[2])

```
Nous créons maintenant notre model linéaire et nous allons procéder à la régression. 
```{r}
#création du modèle 
df = data.frame(regData[1], regData[2], regData[3], regData[4])
col_headings <- c('Académie','Effectif', 'TxRéussiteS', 'TxRéussiteL')
names(df) <- col_headings
model<-lm(df$TxRéussiteS~df$Effectif+df$TxRéussiteL, data = df)
#affichage des résultats
summary(model)
```
### Analyse
On constate que la valeur de R carré est élevée impliquant que le modèle a une importance sur le taux de réussite, selon une p-value extrêmement faible (5.02e-08) soit une précision de 1 sur 1 milliard. 
Cependant nous pouvons aussi observer que les deux variables utilisées n'ont pas le même impact sur notre résultat. 
En effet, l'effectif semble avoir un faible impact (-5.343e-08), tandis que le Taux de réussite en série L a un impact fort (5.170e-01).

Nous pouvons représenter l'impact de l'effectif par le nuage de point suivant, et nous constatons que la droite de la fonction de régression 
```{r}
plot(df$Effectif,df$TxRéussiteS)
x <- seq(0,18000)
lines(x,x*-5.343e-08+4.434e-01,col="red")
```

Nous pouvons représenter l'impact du taux de réussite de la série L par le nuage de points suivant, et nous constatons que la droite de la fonction de régression montre une augmentation forte. 
```{r}
plot(df$TxRéussiteL,df$TxRéussiteS)
x <- seq(0,18000)
lines(x,x*5.170e-01+4.434e-01,col="red")
```

### Conclusion 

Ainsi, selon notre étude de donnée nous pouvons affirmer que l'environnement a un impact sur la réussite d'un élève, mais ce n'est pas la localisation qui crée cette empreinte mais la réussite des paires dans une série différente est-elle un facteur déterminant. 
On peut ainsi estimer qu'un environnement où une filière a un taux de réussite élevé impactera de manière positive les chances de réussite d'un élève. 

## Est ce que le taux de réussite des élèves en terminale S s'explique par la localisation des communes ?

<<<<<<< 020b75ada2fa091a8a3338cc837fbd331950abaf
Nous cherchons à savoir ici sur le fait qu'un étudiant inscrit au baccalauréat d'une commune a plus de chance de réussir que dans une autre commune. Nous allons regarder spécialement la série scientifique.
=======
### Problématique

Nous cherchons à savoir ici si le fait qu'un étudiant inscrit au baccalauréat d'une commune a plus de chance de réussir que dans une autre commune. Nous allons regarder spécialement la série scientifique.
>>>>>>> 9e90d9a087cc4bc4c76b42b31d5b3467a92c609d

### Déroulement du test

La première étape de ce cas de test réunie dans une nouvelle matrice, les colonnes "Ville", "Effectif.Présents.série.S" et "Taux.Brut.de.réussite.série.S". Nous allons tenter d'expliquer par la suite le taux de réussite de chaque ville par les effectifs inscrit dans ces mêmes localisations. Nous irons aussi voir si le taux de réussite de la série L explique en partie le taux de réussite de la série S.

```{r}
bddReg = bdd[, c('Ville','Effectif.Présents.série.S', 'Taux.Brut.de.réussite.série.S', 'Taux.Brut.de.réussite.série.L')]
```

Maintenant que nous disposons des données propres à l'étude de ce cas, nous avons besoin de nettoyer les données. Il faut notamment mettre des valeurs nulles dans les champs non remplis et ramèner le taux à des valeurs comprises entre 0 et 1.

```{r}
# Permet de mettre 0 dans les cases non remplies
bddReg[is.na(bddReg)] <- 0
# Ramène le pourcentage du taux de réussite à une valeur entre 0 et 1
bddReg[3] <- bddReg[3]/100
bddReg[4] <- bddReg[4]/100
```

Pour pallier à des villes où aucun candidat ne serait inscrit dans la série S, nous supprimons volontairement ces enregistrements qui sont considérés comme des individus aberrants pour notre étude. C'est ce que fait la portion de code suivante.

```{r}
df=data.frame(bddReg[1],bddReg[2],bddReg[3], bddReg[4])
df<-df[(df$Effectif.Présents.série.S>0 & df$Taux.Brut.de.réussite.série.S>0 & df$Taux.Brut.de.réussite.série.L>0),]
```

Ce que nous allons faire maintenant, c'est faire un groupement par ville en faisant la somme des effectifs et la moyenne des taux de réussite de chaque établissement pour avoir un seul enregistrement par ville.

```{r}
# Addition des efefctifs groupé par Ville
regData = aggregate(df$Effectif.Présents.série.S, by=list(df$Ville), FUN=sum)
# Moyenne des taux de réussite des séries S assimilée
regData = c(regData,aggregate(df$Taux.Brut.de.réussite.série.S, by=list(df$Ville), FUN=mean)[2])
# Moyenne des taux de réussite des séries L assimilée
regData = c(regData,aggregate(df$Taux.Brut.de.réussite.série.L, by=list(df$Ville), FUN=mean)[2])
```

On peut donc maintenant s'apercevoir de la répartition du taux de réussite S en fonction des effectifs par ville.

```{r}
df = data.frame(regData[1], regData[2], regData[3], regData[4])
col_headings <- c('Ville','EffectifS', 'TxRéussiteS', 'TxRéussiteL')
names(df) <- col_headings
plot(df$EffectifS,df$TxRéussiteS)
```

### Analyse

Nous allons donc effectuer une régression linéaire sur ces données pour tenter d'expliquer le taux de réussites par le lieu d'inscription du candidat au baccalauréat.
```{r}
model<-lm(df$TxRéussiteS~df$EffectifS + df$TxRéussiteL, data = df)
summary(model)
```


On s'aperçoit que l'effectif explique peu le taux de réussite. En effet, pour une unité du taux de réussite, l'effectif change de 2.741e-05 ce qui est très petit.

Le R carré ajusté en tendant vers 0 (adjusted R sqare = 0.005677) nous indique aussi que l'effectif explique faiblement le taux de réussite avec environ 7 chance sur 1000 de se tromper donc cette prédiction est plutôt forte (p-value = 0.007613).

En traçant la droite ax + b correspondant au modèle (2.741e-05*x + 6.171e-01), on remarque sa faible pente et sa représentation plutôt horizontale ce qui indique aussi par le visuel un faible lien.

```{r}
plot(df$EffectifS,df$TxRéussiteS)
x <- seq(0,2300)
lines(x,x*2.741e-05+6.171e-01,col="red")
```

En revanche pour le taux de réussite des séries L explique encore une fois le taux de réussite des séries S. On peut imaginer que le niveau général d'une ville irradie de L en S. Ce lien existe avec un R carré ajusté de 0.1533 avec une p-value infinitésimalement petite. Il y a donc quasiment aucune chance de se tromper sur ce point.

A titre informatif voici la droite du modèle qui représente ce lien :
```{r}
plot(df$TxRéussiteL,df$TxRéussiteS)
x <- seq(0,1)
lines(x,x*3.228e-01+6.171e-01,col="red")
```

### Pour aller plus loin (vérification de l'indépendance de l'effectifs par ville et du taux de réussite des séries S)

Revenons un instant sur la repartition de notre nuage de point effectif serie S et taux de réussite série S. Il s'en dégage quelque chose de curieux que nous souhaitons éclaircir grace à test de chi deux.

Regardons à nouveau le nuage de points :

```{r}
plot(df$EffectifS,df$TxRéussiteS)
```

Nous pouvons voir qu'il semble que les effectifs les plus petits tendent à moins réussir pour certains tandis que nous ne pouvons affirmer celà pour les grands effectifs. Comme nous avons un effectif par ville on peut imaginer qu'il existe un lien entre le nombre d'inscrit d'une ville et sa réussite au baccalauréat serie S.

Pour parvenir à identifier cette dépendance nous allons mettre un place un test de chi deux. Nous allons dans un premier temps compartimenter les données comme ci dessous :

Catégorie effectifs 
  * Inférieur à 300 : Petit
  * Entre 300 et 500 : Moyen
  * Entre 500 et 1000 : Grand
  
Catégorie taux de réussite
  * Entre 0.8 et 0.9 : Bien
  * Entre 0.9 et 1 : Très Bien

Commençons par reconstruire le tableau des effectifs qui nous servira au calcul du khi deux en respectant les catégorie énnoncées ci dessus.

```{r}

# Petit - Très bien
PetitTBien <- sum(df$EffectifS[which(df$EffectifS>=1&df$EffectifS< 300 & df$TxRéussiteS>=0.9&df$TxRéussiteS<= 1 )])

# Petit - Bien
PetitBien <- sum(df$EffectifS[which(df$EffectifS>=1&df$EffectifS< 300 & df$TxRéussiteS>=0.8&df$TxRéussiteS< 0.9 )])

# Moyen - Très bien
MoyenTBien <- sum(df$EffectifS[which(df$EffectifS>=300&df$EffectifS< 500 & df$TxRéussiteS>=0.9&df$TxRéussiteS<= 1 )])

# Moyen - Bien
MoyenBien <- sum(df$EffectifS[which(df$EffectifS>=300&df$EffectifS< 500 & df$TxRéussiteS>=0.8&df$TxRéussiteS< 0.9 )])

# Grand - Très bien
GrandTBien <- sum(df$EffectifS[which(df$EffectifS>=500&df$EffectifS<= 1000 & df$TxRéussiteS>=0.9&df$TxRéussiteS<= 1 )])

# Grand - Bien
GrandBien <- sum(df$EffectifS[which(df$EffectifS>=500&df$EffectifS<= 1000 & df$TxRéussiteS>=0.8&df$TxRéussiteS< 0.9 )])
```

A partir de la construction des valeurs dont nous avons besoin, nous les réunissont dans une matrice.

```{r}
# Unification des données dans une matrice
chideuxData <- data.frame(c(PetitTBien, PetitBien),c(MoyenTBien, MoyenBien), c(GrandTBien, GrandBien))

# Nommage des colonnes et des lignes
names(chideuxData) <- c('Effectif petit', 'Effectif moyen', 'Effectif grand')
rownames(chideuxData) <- c('Très bien', 'Bien')

# Affichage de nos effectifs réels
chideuxData
```

Nous faisons maintenant le calcul de notre khi deux sur nos effectifs.

```{r}
chisq.test(chideuxData)
```

Ce test d'indépendance par khi deux nous démontre qu'il y a dependance entre la taille de l'effectif et le taux de réussite en serie S. Un étudiant a donc plus de chance de réussir dans une grande ville. (P-value infiniment petite.)


#Regression simple

```{r, include=FALSE}
# initialisation des données pour cecile
bdd_complet <- read.csv2(file="geoducation-data2_cecile.csv", sep=";", header=TRUE, na.strings = "")
```


La régression linéaire simple est une méthode statistique permettant de modéliser la relation linéaire entre 2 variables quantitatives.
Nous effectuerons notre régression linéaire sur 2 variables : 
- le taux de réussite (variable à expliquer)
- les effectifs

Nous souhaitons analyser la relation entre le taux de réussite d'un établissement au baccalauréat (exprimé en pourcentage) et son effectif.

```{r}
# [1] Extraction des champs qui nous interessent
chu_reg_simple_extrac_data = bdd_complet[, c('Etablissement','Code.Etablissement','Effectif.Présents.Total.séries','Taux.Brut.de.réussite.Total.séries')]

# [2] Renommage des colonnes
names(chu_reg_simple_extrac_data)[names(chu_reg_simple_extrac_data)=="Etablissement"] <- "Nom_lycee"
names(chu_reg_simple_extrac_data)[names(chu_reg_simple_extrac_data)=="Code.Etablissement"] <- "Code_lycee"
names(chu_reg_simple_extrac_data)[names(chu_reg_simple_extrac_data)=="Effectif.Présents.Total.séries"] <- "Effectif_lycee"
names(chu_reg_simple_extrac_data)[names(chu_reg_simple_extrac_data)=="Taux.Brut.de.réussite.Total.séries"] <- "Taux_reussite"

# [3] Copie de l'extraction pour travailler dessus
chu_reg_simple_bdd = chu_reg_simple_extrac_data 

# [4] Nettoyage des données
# suppression des lignes contenant des NA
chu_reg_simple_bdd <- na.omit(chu_reg_simple_bdd)
# conversion pour la reconnaissance des variables QUANTI
for (i in 3:ncol(chu_reg_simple_bdd)) {
  chu_reg_simple_bdd[, i] <- as.numeric(as.character(chu_reg_simple_bdd[, i]))
}
# visualisation générale des données
str(chu_reg_simple_bdd)
summary(chu_reg_simple_bdd)
plot(Taux_reussite ~ Effectif_lycee, data=chu_reg_simple_bdd)

# [5] Estimation du paramètre Effectif_lycee
# regression linéaire : nuage de points + droite de regression
chu_reg_simple <- lm(Taux_reussite ~ Effectif_lycee, data=chu_reg_simple_bdd)
summary(chu_reg_simple)
chu_reg_simple
abline(chu_reg_simple, col = 'red')
# affichage de l'équation de la droite de régression
title("Nuage de points & droite de regression")
text(400, 50, as.expression(substitute(y==b+a*x, list(
  a=round(chu_reg_simple$coefficients[2],3),
  b=round(chu_reg_simple$coefficients[1],3)
))), col = 'red')
```

Chaque point représente pour un lycée donné, l'effectif de l'établissement et son taux de réussite au baccalauréat.
On remarque que la liaison entre les effectifs et le taux de réussite ne semble pas être linéaire.

\textcolor{red}{Rédaction à revoir et améliorer}

Std.Error = 0.251276 : Ecart-type associé à l'estimation des effectifs est petite, ce qui signifie un gage de stabilité du modèle et donc du pouvoir prédictif (valeur de b stable)
Residual standard error = 6.122 : Estimateur de l'écart-type résiduel est faible donc bon pouvoir prédictif mais DDL à 2286
Multiple R-squared = 0.007084 : coeff de corrélation (% de variations expliquées par le modèle), R² doit être proche de 1 pour bon pouvoir explicatif

Le modèle n'a pas un bon pouvoir explicatif sur les données : R²=0.007084
Le pouvoir prédictif risque d'être entaché par l'instabilité du coefficient b et une variance résiduelle importante

```{r}

```

#Regression multiple

```{r}
# [1] Extraction des champs qui nous interessent
chu_reg_multi_extrac_data = bdd_complet[, c(
  'Secteur.Public.PU.Privé.PR',
  'Sructure.p.dagogique.en.7.groupes',
  'Effectif.Présents.série.L',
  'Effectif.Présents.série.ES', 
  'Effectif.Présents.série.S', 
  'Taux.Brut.de.réussite.série.L', 
  'Taux.Brut.de.réussite.série.ES',
  'Taux.Brut.de.réussite.série.S',
  'Taux.Brut.de.réussite.Total.séries',
  'Taux.accés.Brut.premi.re.BAC',
  'Taux.accés.Brut.terminale.BAC'
)]

# [2] Renommage des colonnes
names(chu_reg_multi_extrac_data) <- c(
  'Secteur_lycee',
  'Sructure_lycee',
  'Effectif_L',
  'Effectif_ES', 
  'Effectif_S', 
  'Reussite_L', 
  'Reussite_ES',
  'Reussite_S',
  'Reussite_Total',
  'Acces_prem_BAC',
  'Acces_term_BAC'
)

# [3] Copie de l'extraction pour travailler dessus
chu_reg_multi_bdd = chu_reg_multi_extrac_data
str(chu_reg_multi_bdd)

# [4] Nettoyage des données
# on ne s'interesse que aux données des établissements avec uniquement des filières généraux
chu_reg_multi_bdd <- subset(chu_reg_multi_bdd, Sructure_lycee == "A")
# suppression des lignes contenant des NA
chu_reg_multi_bdd <- na.omit(chu_reg_multi_bdd)
# suppression des colonnes non utilisées pour la regression
chu_reg_multi_bdd <- chu_reg_multi_bdd[,-2]
# conversion pour la reconnaissance des variables QUANTI
for (i in 2:ncol(chu_reg_multi_bdd)) {
  chu_reg_multi_bdd[, i] <- as.numeric(as.character(chu_reg_multi_bdd[, i]))
}
# remplacement de la variable quali en quanti
chu_reg_multi_bdd[, 1] <- as.character(chu_reg_multi_bdd[, 1])
chu_reg_multi_bdd$Secteur_lycee[chu_reg_multi_bdd$Secteur_lycee=="PR"]<-"1"
chu_reg_multi_bdd$Secteur_lycee[chu_reg_multi_bdd$Secteur_lycee=="PU"]<-"0"
chu_reg_multi_bdd[, 1] <- as.numeric(chu_reg_multi_bdd[, 1])

# [5] Estimation des paramètres explicatives
chu_reg_multi <- lm(Reussite_Total ~ ., data=chu_reg_multi_bdd)
summary(chu_reg_multi)
```
R² = 97% donc le modèle est précis
Nous avons 97% de la variance du taux de réussite qui peut être expliquée par les variations de ... 
```{r}
#chu_reg_multi
hist(resid(chu_reg_multi), col="grey", main="")
```

Conclusion en cours de rédaction

#Conclusion Générale



